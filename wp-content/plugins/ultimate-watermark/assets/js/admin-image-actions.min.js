jQuery(document).ready(function(n){watermarkImageActions={running:!1,action_location:"",action:"",response:"",selected:[],successCount:0,skippedCount:0,init:function(){n(document).on("click",".bulkactions input#doaction, .bulkactions input#doaction2",function(e){action=n(this).parent().children("select").val(),(ulwmImageActionArgs.backup_image||"removewatermark"!==action)&&("applywatermark"!=action&&"removewatermark"!=action&&"apply_video_watermark"!=action||(e.preventDefault(),!1===watermarkImageActions.running?(watermarkImageActions.running=!0,watermarkImageActions.action=action,watermarkImageActions.action_location="upload-list",n(".wp-list-table .check-column input:checkbox:checked").each(function(){watermarkImageActions.selected.push(n(this).val())}),n(".ulwm-notice").slideUp("fast",function(){n(this).remove()}),watermarkImageActions.post_loop()):watermarkImageActions.notice("ulwm-notice error",ulwmImageActionArgs.__running,!1)))}),n(document).on("click","#ultimate_watermark_buttons a.ulwm-watermark-action",function(e){action=n(this).attr("data-action"),id=n(this).attr("data-id"),("applywatermark"==action||"removewatermark"==action||"apply_video_watermark"==action&&!isNaN(id))&&(e.preventDefault(),watermarkImageActions.action=action,!1===watermarkImageActions.running?(watermarkImageActions.running=!0,watermarkImageActions.action=action,n(this).parents(".media-modal ").length?watermarkImageActions.action_location="media-modal":watermarkImageActions.action_location="edit",watermarkImageActions.selected.push(id),n(".ulwm-notice").slideUp("fast",function(){n(this).remove()}),watermarkImageActions.post_loop()):watermarkImageActions.notice("ulwm-notice error",ulwmMediaModal.__running,!1))}),n(document).on("click",".ulwm-notice.is-dismissible .notice-dismiss",function(){n(this).parents(".ulwm-notice").slideUp("fast",function(){n(this).remove()})})},post_loop:function(){watermarkImageActions.selected.length?(id=watermarkImageActions.selected[0],isNaN(id)?(watermarkImageActions.selected.splice(0,1),watermarkImageActions.post_loop()):(watermarkImageActions.row_image_feedback("loading",id),data={_ulwm_nonce:ulwmImageActionArgs._nonce,action:"ulwm_watermark_bulk_action","ulwm-action":watermarkImageActions.action,attachment_id:id},"upload-list"==watermarkImageActions.action_location&&watermarkImageActions.scroll_to("#post-"+id,"bottom"),n.post(ajaxurl,data,function(e){watermarkImageActions.result(e,id),watermarkImageActions.selected.splice(0,1),watermarkImageActions.post_loop(),n(".ulwm-overlay").first().each(function(){n(this).fadeOut("fast",function(){n(this).remove(),"watermarked"===e.data?(n("#ultimate_watermark_buttons .value").append('<span class="dashicons dashicons-yes" style="font-size: 24px;float: none;min-width: 28px;padding: 0;margin: 0; display: none;"></span>'),n("#ultimate_watermark_buttons .value .dashicons").fadeIn("fast")):"watermarkremoved"===e.data&&(n("#ultimate_watermark_buttons .value").append('<span class="dashicons dashicons-yes" style="font-size: 24px;float: none;min-width: 28px;padding: 0;margin: 0; display: none;"></span>'),n("#ultimate_watermark_buttons .value .dashicons").fadeIn("fast")),n("#ultimate_watermark_buttons .value .dashicons").delay(1500).fadeOut("fast",function(){n(this).remove()})})})}))):watermarkImageActions.reset()},result:function(e,a){if(!0===e.success){var t=!1,i="",o=!0;switch(watermarkImageActions.response=e.data,e.data){case"watermarked":t="ulwm-notice updated ulwm-watermarked",watermarkImageActions.successCount+=1,i=1<watermarkImageActions.successCount?ulwmImageActionArgs.__applied_multi.replace("%s",watermarkImageActions.successCount):ulwmImageActionArgs.__applied_one,watermarkImageActions.row_image_feedback("success",a),watermarkImageActions.reload_image(a);break;case"watermarkremoved":t="ulwm-notice updated ulwm-watermarkremoved",watermarkImageActions.successCount+=1,i=1<watermarkImageActions.successCount?ulwmImageActionArgs.__removed_multi.replace("%s",watermarkImageActions.successCount):ulwmImageActionArgs.__removed_one,watermarkImageActions.row_image_feedback("success",a),watermarkImageActions.reload_image(a);break;case"skipped":t="ulwm-notice error ulwm-skipped",watermarkImageActions.skippedCount+=1,i=ulwmImageActionArgs.__skipped+": "+watermarkImageActions.skippedCount,watermarkImageActions.row_image_feedback("error",a);break;default:t="ulwm-notice error ulwm-message",i=e.data,watermarkImageActions.row_image_feedback("error",a),o=!1}!1!==t&&watermarkImageActions.notice(t,i,o)}else watermarkImageActions.notice("ulwm-notice error",e.data,!1),watermarkImageActions.row_image_feedback("error",a)},row_image_feedback:function(e,a){var t,i={},o={};switch(watermarkImageActions.action_location){case"upload-list":i={display:"table",width:n(t=".wp-list-table #post-"+a+" .media-icon").width()+"px",height:n(t).height()+"px",top:"0",left:"0",position:"absolute",font:"normal normal normal dashicons",background:"rgba(255,255,255,0.75)",content:""},o={"vertical-align":"middle","text-align":"center",display:"table-cell",width:"100%",height:"100%"};break;case"edit":i={display:"table",width:n((t=".wp_attachment_holder #thumbnail-head-"+a)+" img").width()+"px",height:n(t+" img").height()+"px",top:"0",left:"0",position:"absolute",font:"normal normal normal dashicons",background:"rgba(255,255,255,0.75)",content:""},o={"vertical-align":"middle","text-align":"center",display:"table-cell",width:"100%",height:"100%"};break;case"media-modal":t='.media-modal #ultimate_watermark_buttons[data-id="'+a+'"] .value',i={"float":"none"},o={"float":"none"};break;default:return!1}n(t).css("position","relative"),n(t+" .ulwm-overlay").length||n(t).append('<span class="ulwm-overlay"><span class="ulwm-overlay-inner"></span></span>'),n(t+" .ulwm-overlay").css(i),n(t+" .ulwm-overlay .ulwm-overlay-inner").css(o),n(t+" .ulwm-overlay .ulwm-overlay-inner").html('<span class="spinner is-active"></span>'),"media-modal"===watermarkImageActions.action_location&&n(t+" .ulwm-overlay .ulwm-overlay-inner .spinner").css({"float":"none",padding:0,margin:"-4px 0 0 10px"})},notice:function(e,a,t){if("media-modal"!==watermarkImageActions.action_location){switch(e+=" notice is-dismissible",watermarkImageActions.action_location){case"upload-list":prefix=".wrap > h1";break;default:prefix="#ultimate_watermark_buttons"}if(!0===t){switch(selector=!1,watermarkImageActions.response){case"watermarked":selector=".ulwm-notice.ulwm-watermarked";break;case"watermarkremoved":selector=".ulwm-notice.ulwm-watermarkremoved";break;case"skipped":selector=".ulwm-notice.ulwm-skipped"}if(selector&&n(".wrap "+selector+" > p").length){switch(watermarkImageActions.action_location){case"upload-list":prefix=".wrap ";break;default:prefix="#ultimate_watermark_buttons "}n(prefix+selector+" > p").html(a)}else n(prefix).after('<div class="'+e+'" style="display: none;"><p>'+a+'</p><button type="button" class="notice-dismiss"><span class="screen-reader-text">'+ulwmImageActionArgs.__dismiss+"</span></button></div>"),n(".ulwm-notice").slideDown("fast")}else n(prefix).after('<div class="'+e+'" style="display: none;"><p>'+a+'</p><button type="button" class="notice-dismiss"><span class="screen-reader-text">'+ulwmImageActionArgs.__dismiss+"</span></button></div>"),n(".ulwm-notice").slideDown("fast")}},reset:function(){watermarkImageActions.running=!1,watermarkImageActions.action="",watermarkImageActions.response="",watermarkImageActions.selected=[],watermarkImageActions.successCount=0,watermarkImageActions.skippedCount=0,setTimeout(function(){n(".ulwm-overlay").each(function(){n(this).fadeOut("fast",function(){n(this).remove()})})},100)},reload_image:function(e){switch(time=(new Date).getTime(),selector=!1,watermarkImageActions.action_location){case"upload-list":selector=".wp-list-table #post-"+e+" .image-icon img";break;case"media-modal":selector='.attachment-details[data-id="'+e+'"] img, .attachment[data-id="'+e+'"] img';break;case"edit":selector=".wp_attachment_holder img"}selector&&(image=n(selector),image.each(function(){n(this).removeAttr("srcset"),n(this).removeAttr("sizes"),n(this).attr("src",watermarkImageActions.replace_url_param(n(this).attr("src"),"t",time))}))},rotate_icon:function(t){"string"==typeof t&&(t=n(t)),n(t.selector).length&&(t.css({"-webkit-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)",transform:"rotate(0deg)",borderSpacing:"0"}),t.animate({borderSpacing:360},{duration:1e3,step:function(e,a){n(this).css("-webkit-transform","rotate("+e+"deg)"),n(this).css("-ms-transform","rotate("+e+"deg)"),n(this).css("transform","rotate("+e+"deg)"),360==e&&(t.stop(),watermarkImageActions.rotate_icon(t))}}))},replace_url_param:function(e,a,t){var i=new RegExp("\\b("+a+"=).*?(&|$)");return 0<=e.search(i)?e.replace(i,"$1"+t+"$2"):e+(0<e.indexOf("?")?"&":"?")+a+"="+t},scroll_to:function(e,a){var t=n(e).offset(),i=t.top;if(t.top<n(window).scrollTop())n(window).scrollTop(i);else{var o=n(window).scrollTop(),r=o+n(window).outerHeight();switch(a){case"top":i-=n(e).outerHeight();break;case"bottom":if(t.top<r)return;i-=n(window).outerHeight(),i+=n(e).outerHeight();break;case"center":if(i<r&&o<=i)return;i-=n(window).outerHeight()/2,i+=n(e).outerHeight()/2}n(window).scrollTop(i)}}},"undefined"!=typeof ulwmImageActionArgs._nonce&&watermarkImageActions.init()});